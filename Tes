$testPath = Get-Location
$logFile = "$testPath\dd_log.txt"
$ddPath = "$testPath\dd\dd.exe"

# Get all physical drives using wmic
$drives = (Get-WmiObject -Query "SELECT DeviceID FROM Win32_DiskDrive").DeviceID

# Iterate through each physical drive for processing
foreach ($drive in $drives) {
    try {
        # Execute dd command for each drive
        $command = "& `"$ddPath`" if=`"$drive`" of=/dev/null bs=1M --progress"
        Add-Content -Path $logFile -Value "Running: $command"

        # Execute the command and capture output
        $output = & $ddPath if="$drive" of=/dev/null bs=1M --progress 2>&1

        # Log the output
        if ($output) {
            Add-Content -Path $logFile -Value $output
        }

        # Check for errors in the output explicitly
        if ($output -match "Error reading file 1117") {
            Add-Content -Path $logFile -Value "Non-critical error occurred: $output"
        } elseif ($output -match "Error") {
            Add-Content -Path $logFile -Value "Error occurred during execution: $output"
            # Throw error to stop further execution immediately
            throw "Critical error encountered. Stopping execution."
        } else {
            Add-Content -Path $logFile -Value "Execution completed successfully for drive: $drive"
        }
    } catch {
        # Log any errors to the log file
        Add-Content -Path $logFile -Value "Error processing drive ${drive}: $($_.Exception.Message)"
        # Exit immediately with an error code
        exit 1
    }
}


        $errors = ($output -split "`n") | Where-Object { $_ -match "Error" -and $_ -notmatch "Error reading file 1117" }
        if ($errors.Length -gt 0) {
